<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>الباحث في رموز القبائل</title>
  <meta name="description" content="اكتشف رموز القبائل العربية ومعلوماتها التفصيلية وأصولها التاريخية عبر أكبر بااحث متخصص. ابحث بالرمز أو اسم القبيلة الآن واستكشف إرث وتاريخ القبائل في الوطن العربي.">
  <!-- خط IBM Plex Sans Arabic -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet" />
  <!-- مكتبة أيقونات Boxicons -->
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "الباحث في رموز وأنساب القبائل العربية",
    "url": "https://kolkxodl.github.io/Ramz/",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://kolkxodl.github.io/Ramz/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "ما هو الباحث في رموز القبائل؟",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "هو موقع ويب يتيح لك البحث عن رموز القبائل العربية المختلفة ومعرفة المزيد من المعلومات عنها وعن تاريخها."
        }
      },
      {
        "@type": "Question",
        "name": "كيف يمكنني البحث عن قبيلة معينة؟",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "يمكنك إدخال رمز القبيلة أو اسمها في شريط البحث الموجود في الصفحة الرئيسية، وسيقوم الموقع بعرض النتائج المطابقة."
        }
      },
      {
        "@type": "Question",
        "name": "هل المعلومات المتوفرة دقيقة؟",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "نحن نسعى جاهدين لتقديم معلومات دقيقة وموثوقة، ونقوم بتحديث البيانات بشكل دوري. إذا لاحظت أي خطأ، يمكنك التواصل معنا لتصحيحه."
        }
      },
      {
        "@type": "Question",
        "name": "هل يمكنني إضافة قبيلة غير موجودة؟",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "نعم، إذا لم تجد قبيلة معينة، يمكنك التواصل معنا عبر وسائل التواصل المتاحة لتزويدنا بالمعلومات وسنعمل على إضافتها في أقرب وقت."
        }
      }
    ]
  }
  </script>
  <style>
    body {
      background: linear-gradient(135deg, #FAF3E0, #F2E8D5);
      color: #5C4033;
      direction: rtl;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      line-height: 1.6;
      text-align: center;
      padding-top: 120px;
      transition: opacity 0.5s ease;
    }
    body.fade-out {
      opacity: 0;
    }
    /* منع التمرير عند ظهور النافذة المنبثقة */
    body.no-scroll {
      overflow: hidden;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "IBM Plex Sans Arabic", sans-serif;
    }
    a {
      text-decoration: none;
      color: inherit;
    }
    h1, h2, h3, h4, h5, h6 {
      color: #3E2723;
    }
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 10;
      background: rgba(139, 69, 19, 0.8);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      color: #fff;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-direction: row-reverse;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
    .logo {
      height: 50px;
      filter: brightness(0) invert(1);
    }
    .hamburger {
      font-size: 24px;
      cursor: pointer;
      color: #fff;
      padding: 8px;
      border-radius: 6px;
      transition: background-color 0.3s;
    }
    .hamburger.active {
      background-color: rgba(255, 255, 255, 0.2);
    }
    #sidebar {
      position: fixed;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      width: 250px;
      height: 100%;
      background: rgba(255, 255, 255, 0.7);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      color: #5C4033;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
      padding: 20px;
      z-index: 20;
    }
    #sidebar.active {
      transform: translateX(0);
    }
    #sidebar .close-btn {
      font-size: 22px;
      cursor: pointer;
      text-align: right;
      margin-bottom: 15px;
      color: #5C4033;
    }
    #sidebar .sidebar-logo {
      margin-bottom: 15px;
    }
    #sidebar .sidebar-logo img {
      height: 45px;
      width: auto;
      filter: brightness(0);
    }
    #sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 16px;
      text-align: center;
    }
    #sidebar ul li {
      margin: 12px 0;
      border-bottom: 1px solid #EFE8DC;
      padding-bottom: 8px;
    }
    #sidebar ul li:last-child {
      border-bottom: none;
    }
    #sidebar ul li a {
      color: #5C4033;
      font-weight: bold;
      cursor: pointer;
    }
    #socialContainer {
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      transition: max-height 0.5s ease, opacity 0.5s ease;
    }
    #socialContainer.active {
      max-height: 50px;
      opacity: 1;
      margin-top: 10px; 
    }
    #socialContainer a {
      margin: 0 8px;
      font-size: 20px;
      color: #D2B48C;
      transition: color 0.3s;
    }
    #socialContainer a:hover {
      color: #CD853F;
    }
    .container {
      background: rgba(255, 255, 255, 0.7);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      margin: 60px auto 30px;
      max-width: 800px;
      width: 90%;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .container h2 {
        margin-bottom: 25px; /* Original margin */
    }
    .input-container {
      position: relative;
      margin-top: 15px; /* Added margin for spacing from title */
      margin-bottom: 20px;
      width: 100%;
    }
    .input-container input[type="text"] {
      width: 100%;
      padding: 14px 45px 14px 45px;
      border: 2px solid #D2B48C;
      border-radius: 30px;
      font-size: 16px;
      text-align: center;
      outline: none;
      transition: border-color 0.3s, box-shadow 0.3s;
      background-color: #fff;
      color: #3E2723;
    }
    .input-container input[type="text"]:focus {
      border-color: #CD853F;
      box-shadow: 0 0 8px rgba(205, 133, 63, 0.3);
    }
    .input-container .input-icon {
      position: absolute;
      top: 50%;
      right: 18px;
      transform: translateY(-50%);
      font-size: 20px;
      pointer-events: none;
      color: #D2B48C;
    }
    .input-container .clear-icon {
      position: absolute;
      top: 50%;
      left: 18px;
      transform: translateY(-50%);
      font-size: 20px;
      color: #D2B48C;
      cursor: pointer;
      display: none;
    }
    .search-button {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 30px;
      background: linear-gradient(90deg, #CD853F, #D2B48C);
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }
    .search-button:hover {
      background: linear-gradient(90deg, #D2B48C, #CD853F);
    }
    .result {
      margin-top: 20px;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      font-size: 18px;
      text-align: center; /* Center the result boxes themselves */
      color: #3E2723;
    }
    .result.show {
      opacity: 1;
    }
     .result .tribe-box {
      background: rgba(253, 248, 240, 0.8);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      border: 1px solid #D2B48C;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      color: #3E2723;
    } 
    
    .result .history-box {
      background: rgba(253, 248, 240, 0.8);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      border: 1px solid #D2B48C;
      padding: 12px;
      border-radius: 8px;
      margin: 0 auto 12px auto; 
      color: #3E2723;
      font-size: 18px; 
    }
    .result .history-box h4 {
        margin-bottom: 10px;
        color: #CD853F;
        font-size: 17px; 
        text-align: center;
    }
    .result .history-box p {
        margin: 0; 
        text-align: center; 
    }
    /* إضافة تنسيق لمربع عرض شيخ القبيلة */
    .result .sheikh-box {
      background: rgba(253, 248, 240, 0.8);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      border: 1px solid #D2B48C;
      padding: 12px;
      border-radius: 8px;
      margin: 0 auto 12px auto; 
      color: #3E2723;
      font-size: 18px;
      text-align: center;
    }
    .result .sheikh-box .sheikh-image-container {
      width: 100%;
      margin-bottom: 10px;
      display: flex;
      justify-content: center;
    }
    .result .sheikh-box .sheikh-image {
      max-width: 100%;
      max-height: 300px;
      border-radius: 8px;
      object-fit: contain;
    }
    .result .sheikh-box .sheikh-name {
      color: #CD853F; /* Golden color - Updated */
      font-weight: bold;
      font-size: 18px;
      margin-top: 8px;
      text-align: center;
    }
    .result-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .result-table thead {
      background-color: #EAD7C0;
    }
    .result-table thead th {
      padding: 12px;
      border: none;
      color: #3E2723;
      font-weight: bold;
    }
    .result-table tbody tr {
      background-color: #fff;
    }
    .result-table tbody tr:nth-child(even) {
      background-color: #F7F1E1;
    }
    .result-table tbody td {
      padding: 10px;
      border: none;
      color: #5C4033;
      border-bottom: 1px solid #EFE8DC;
      text-align: center; 
    }
    .result-table tbody tr:last-child td {
      border-bottom: none;
    }
    .ad-container {
      background: rgba(255, 255, 255, 0.7);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      margin: 30px auto;
      max-width: 800px;
      width: 90%;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    .ad-container h3 {
      font-size: 22px;
      margin-bottom: 10px;
      color: #3E2723;
    }
    .ad-container p {
      font-size: 16px;
      margin-bottom: 20px;
      color: #5C4033;
    }
    .ad-button {
      padding: 10px 20px;
      border: none;
      border-radius: 30px;
      background: linear-gradient(90deg, #CD853F, #D2B48C);
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .ad-button:hover {
      background: linear-gradient(90deg, #D2B48C, #CD853F);
    }
    .faq-container {
      background: rgba(255, 255, 255, 0.7);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      max-width: 800px;
      width: 90%;
      margin: 30px auto;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .faq-container h3 {
      font-size: 22px;
      margin-bottom: 20px;
      color: #3E2723;
      text-align: center;
    }
    .faq-item {
      border: 1px solid #EDE7E3;
      border-radius: 8px;
      margin-bottom: 10px;
      overflow: hidden;
    }
    .faq-question {
      background-color: #F9F3EE;
      padding: 12px 18px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: background-color 0.3s;
      color: #5C4033;
      font-size: 16px;
      text-align: right;
    }
    .faq-question:hover,
    .faq-question.active {
      background-color: #F3EDE7;
    }
    .faq-question .faq-icon {
      font-size: 18px;
      margin-left: 10px;
      transition: transform 0.3s;
    }
    .faq-question.active .faq-icon {
      transform: rotate(180deg);
    }
    .faq-answer {
      padding: 12px 18px;
      display: none;
      background-color: #fff;
      text-align: right;
      color: #3E2723;
      font-size: 15px;
    }
    .contact-container {
      background: rgba(255, 255, 255, 0.7);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      max-width: 800px;
      width: 90%;
      margin: 30px auto;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    .contact-container h3 {
      font-size: 20px;
      margin-bottom: 12px;
      color: #3E2723;
    }
    .contact-container .social-icons a {
      margin: 0 8px;
      font-size: 20px;
      color: #D2B48C;
      transition: color 0.3s;
    }
    .contact-container .social-icons a:hover {
      color: #CD853F;
    }
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0;
    }
    .loading-circle {
      border: 4px solid #D2B48C;
      border-top: 4px solid #CD853F;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    .loading-text {
      margin-top: 10px;
      font-size: 16px;
      color: #5C4033;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    footer {
      background: rgba(139, 69, 19, 0.8);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      color: #F5F5DC;
      padding: 15px;
      text-align: center;
      font-size: 14px;
      margin-top: auto;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.2);
    }
    footer p {
      margin-bottom: 5px;
    }
    footer .extra {
      font-size: 12px;
      color: #F5F5DC;
    }
    @media (max-width: 600px) {
      .container,
      .faq-container,
      .contact-container,
      .ad-container {
        margin: 20px auto;
        padding: 20px;
      }
      .input-container input[type="text"] {
        padding: 12px 35px 12px 35px;
      }
      .search-button {
        font-size: 16px;
        padding: 12px;
      }
      .faq-container h3, .container h2 {
        font-size: 20px;
      }
      
      .result .history-box {
        font-size: 14px; 
        padding: 10px;
      }
      .result .history-box h4 {
        font-size: 16px;
      }
      .result .sheikh-box .sheikh-name {
        font-size: 16px;
      }
      /* Adjust welcome popup for smaller screens */
      .welcome-popup-content {
          max-width: 90%;
          padding: 15px;
      }
      .welcome-popup-content p {
          font-size: 14px; /* Slightly smaller text */
          line-height: 1.7;
      }
      .welcome-popup-content h4 {
          font-size: 16px; /* Smaller heading */
      }
      .welcome-popup-content ul {
          padding-right: 15px; /* Adjust list padding */
      }
      .welcome-popup-content li {
          font-size: 13px; /* Smaller list items */
          margin-bottom: 8px;
      }
      /* Adjust social media popup for smaller screens */
      .social-popup-content {
          max-width: 90%;
          padding: 15px;
      }
      .social-popup-content p {
          font-size: 14px;
          line-height: 1.7;
      }
      .social-popup-content h4 {
          font-size: 16px;
      }
    }
    .popup-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 30; /* Default z-index for popups */
    }
    .popup-content {
      background: rgba(255, 255, 255, 0.8);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      max-width: 90%;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      animation: popupAnimation 0.5s ease;
    }
    /* Welcome Popup Specific Styles */
    .welcome-popup-content {
        max-width: 480px; /* تصغير حجم النافذة */
        text-align: right; /* Align text to the right */
        line-height: 1.8;
        color: #3E2723;
        margin: 20px; /* إضافة مسافة من حواف الشاشة */
    }
    .welcome-popup-content h4 {
        color: #CD853F; /* Golden color for heading */
        margin-bottom: 15px;
        font-size: 18px;
        text-align: center; /* Center the heading */
    }
    .welcome-popup-content p {
        margin-bottom: 12px;
        font-size: 15px;
    }
    .welcome-popup-content ul {
        list-style: none; /* Remove default bullets */
        padding-right: 20px; /* Indent list */
        margin-bottom: 15px;
    }
    .welcome-popup-content li {
        margin-bottom: 10px;
        font-size: 14px;
        position: relative;
        padding-right: 25px; /* Space for custom bullet */
    }
    .welcome-popup-content li::before {
        content: "\25AA"; /* Unicode for small square or use a bullet */
        color: #CD853F; /* Golden color for bullet */
        font-size: 18px; /* Adjust bullet size */
        position: absolute;
        right: 0;
        top: -2px; /* Adjust vertical alignment */
    }
    .welcome-popup-content .popup-buttons {
        margin-top: 20px; /* More space before button */
    }

    /* Social Media Follow Popup Specific Styles */
    .social-popup-content {
        max-width: 450px;
        text-align: center;
        line-height: 1.8;
        color: #3E2723;
        margin: 20px;
    }
    .social-popup-content h4 {
        color: #CD853F;
        margin-bottom: 15px;
        font-size: 18px;
    }
    .social-popup-content p {
        margin-bottom: 20px;
        font-size: 16px;
    }
    .social-popup-content .social-buttons {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 15px;
    }
    .social-popup-content .social-btn {
        padding: 12px 25px;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        font-size: 16px;
        transition: background 0.3s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        color: #fff;
        text-decoration: none;
    }
    .social-popup-content .instagram-btn {
        background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
    }
    .social-popup-content .instagram-btn:hover {
        background: linear-gradient(45deg, #e6683c 0%,#dc2743 25%,#cc2366 50%,#bc1888 75%,#8b0a6b 100%);
    }
    .social-popup-content .facebook-btn {
        background: linear-gradient(90deg, #00c262, #00a12a);
    }
    .social-popup-content .facebook-btn:hover {
        background: linear-gradient(90deg, #00c262, #00a12a);
    }

    @keyframes popupAnimation {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .popup-buttons {
      margin-top: 15px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .popup-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      background: linear-gradient(90deg, #CD853F, #D2B48C);
      color: #fff;
      font-size: 16px;
      transition: background 0.3s;
      display: inline-flex; /* To allow icon and text alignment */
      align-items: center;
      justify-content: center;
      gap: 8px; /* Gap between icon and text */
    }
    .popup-btn:hover {
      background: linear-gradient(90deg, #D2B48C, #CD853F);
    }
    .popup-btn:disabled {
      background: #cccccc; /* Grey color for disabled state */
      cursor: not-allowed;
    }
    
    /* Styles for Image Lightbox */
    .image-lightbox {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none; /* Hidden by default */
      align-items: center;
      justify-content: center;
      z-index: 1000; /* Ensure it's on top */
      cursor: pointer; /* Indicate it can be clicked to close */
    }
    .image-lightbox img {
      max-width: 90%;
      max-height: 85%;
      border-radius: 5px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .image-lightbox .close-lightbox {
      position: absolute;
      top: 20px;
      right: 30px;
      color: #fff;
      font-size: 30px;
      font-weight: bold;
      cursor: pointer;
    }
    /* End Styles for Image Lightbox */
    
    /* Success Notification Styles */
    .success-notification {
      position: fixed;
      top: 20px;
      right: -400px; /* Start off-screen */
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      z-index: 1001;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      font-weight: bold;
      min-width: 300px;
      transition: right 0.5s ease-in-out;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .success-notification.show {
      right: 20px; /* Slide in */
    }
    .success-notification .check-icon {
      font-size: 24px;
      color: white;
    }
    .success-notification .notification-text {
      flex: 1;
      text-align: right;
    }
    /* End Success Notification Styles */
    
  </style>
</head>
<body>
  <header>
    <div class="hamburger" id="openSidebar">
      <i class="bx bx-menu"></i>
    </div>
    <img src="https://www2.0zz0.com/2025/04/03/00/209652548.png" alt="الشعار" class="logo" oncontextmenu="return false;" draggable="false" />
  </header>
  <nav id="sidebar">
    <div class="close-btn" id="closeSidebar">
      <i class="bx bx-x"></i>
    </div>
    <div class="sidebar-logo">
      <img src="https://www2.0zz0.com/2025/04/03/00/209652548.png" alt="الشعار" oncontextmenu="return false;" draggable="false" />
    </div>
    <ul>
      <li><a id="homeLink" href="#">الصفحة الرئيسية</a></li>
      <li>
        <a id="contactLink" href="#">تواصل معنا</a>
        <div id="socialContainer">
          <a href="https://youtube.com/@designer_co2?si=0UkuOB6YMiOg1rDY" target="_blank"><i class="bx bxl-youtube"></i></a>
          <a href="https://wa.me/967738889982" target="_blank"><i class="bx bxl-whatsapp"></i></a>
          <a href="https://www.facebook.com/share/16v7ZWvJQB/" target="_blank"><i class="bx bxl-facebook"></i></a>
          <a href="https://www.instagram.com/designer_co3?igsh=b3VucWs1cDhqc2c1" target="_blank"><i class="bx bxl-instagram"></i></a>
        </div>
      </li>
      <li><a id="aboutLink" href="about.html">حول</a></li>
      <li><a id="orderLink" href="order.html">لـ طلب تصميم موقع</a></li>
    </ul>
  </nav>
  <div class="container">
    <h2>الباحث في رموز ومعلومات القبائل</h2>
    <div class="input-container">
      <input type="text" id="searchInput" placeholder="أدخل رمز القبيلة او اسمها  "enterkeyhint="go" />
      <i class="bx bx-search input-icon"></i>
      <i class="bx bx-x clear-icon" id="clearBtn"></i>
    </div>
    <button id="searchBtn" class="search-button">
      <i class="bx bx-search"></i>
      بحث
    </button>
    <div id="result" class="result"></div>
    <div id="loading" class="loading" style="display: none;">
      <div class="loading-circle"></div>
      <div class="loading-text">جارٍ البحث…</div>
    </div>
  </div>
  <div class="ad-container">
    <h3>اعلاناتنا</h3>
    <p>هل تريد الإعلان على الموقع ؟<br>تواصل معنا عبر الواتساب للتفاصيل</p>
    <button id="adTelegramBtn" class="ad-button">
      <i class="bx bxl-whatsapp"></i>
      تواصل عبر الواتساب 
    </button>
  </div>
  <div class="faq-container">
    <h3>الأسئلة الشائعة</h3>
    <div class="faq-item">
      <div class="faq-question"><span>1. وش المقصود برموز القبائل؟</span><i class="bx bx-chevron-down faq-icon"></i></div>
      <div class="faq-answer">رموز القبائل هي أرقام يختارها أفراد القبيلة لتمثيلها بشكل رمزي، غالبًا في مواقع التواصل، وتستخدم كنوع من الفخر بالانتماء.</div>
    </div>
    <div class="faq-item">
      <div class="faq-question"><span>2. هل رموز القبائل رسمية؟</span><i class="bx bx-chevron-down faq-icon"></i></div>
      <div class="faq-answer">لا. الرموز غير رسمية ولا معتمدة من أي جهة حكومية. هي رموز اجتهادية وشعبية يستخدمها الشباب بشكل غير رسمي.</div>
    </div>
    <div class="faq-item">
      <div class="faq-question"><span>3. من اللي يحدد رمز القبيلة؟</span><i class="bx bx-chevron-down faq-icon"></i></div>
      <div class="faq-answer">عادةً يتم تداول الرمز بين أفراد القبيلة حتى ينتشر ويصبح معروف، ولا توجد جهة رسمية تحدده.</div>
    </div>
    <div class="faq-item">
      <div class="faq-question"><span>4. هل ممكن أكثر من قبيلة تستخدم نفس الرقم؟</span><i class="bx bx-chevron-down faq-icon"></i></div>
      <div class="faq-answer">نعم، أحيانًا أكثر من قبيلة تستخدم نفس الرمز خاصةً إذا كان الرقم مميزًا أو ذو شعبية.</div>
    </div>
    <div class="faq-item">
      <div class="faq-question"><span>5. هل كل القبائل لها رموز؟</span><i class="bx bx-chevron-down faq-icon"></i></div>
      <div class="faq-answer">لا، بعض القبائل لها رموز متداولة بينما لا تهتم البعض الآخر بتلك الرموز.</div>
    </div>
  </div>
  <div class="contact-container">
    <h3>تابعنا على</h3>
    <div class="social-icons">
      <a href="https://youtube.com/@designer_co2?si=0UkuOB6YMiOg1rDY" target="_blank"><i class="bx bxl-youtube"></i></a>
      <a href="https://wa.me/967738889982" target="_blank"><i class="bx bxl-whatsapp"></i></a>
      <a href="https://www.facebook.com/share/16v7ZWvJQB/" target="_blank"><i class="bx bxl-facebook"></i></a>
      <a href="https://www.instagram.com/designer_co3?igsh=b3VucWs1cDhqc2c1" target="_blank"><i class="bx bxl-instagram"></i></a>
    </div>
  </div>

  <!-- Existing Popup Modal for general messages -->
  <div id="popupModal" class="popup-modal">
    <div class="popup-content">
      <p id="popupMessage"></p>
      <div class="popup-buttons">
        <button id="contactBtn" class="popup-btn">تواصل</button>
        <button id="cancelBtn" class="popup-btn">الغاء</button>
      </div>
    </div>
  </div>

  <!-- Social Media Follow Popup Modal -->
  <div id="socialPopupModal" class="popup-modal" style="z-index: 35;"> 
    <div class="popup-content social-popup-content">
      <h4>ادعم المحتوى بمتابعتنا!</h4>
      <p>لمتابعة البحث واستكشاف المزيد من رموز القبائل، يرجى دعمنا بمتابعه قناه الواتساب والتفاعل على اسم ( احمد الحميقاني ).</p>
      <div class="social-buttons">
<a href="https://whatsapp.com/channel/0029VbCWox5Fy727jnQ7Nq0q" target="_blank" class="social-btn facebook-btn" id="instagramLink">
          <i class=\'bx bxl-Whatsapp\\' style="font-size: 20px;"></i> 
          متابعة على قناه الواتساب
        </a>
        <a href="https://whatsapp.com/channel/0029VbCWox5Fy727jnQ7Nq0q/140" target="_blank" class="social-btn instagram-btn" id="facebookLink">
          <i class=\'bx bxl-facebook\\' style="font-size: 20px;"></i> 
        الاعجاب او التفاعل على الرساله باسم <br>( احمد الحميقاني ) 
        </a>
      </div>
      <!-- زر التحقق الجديد -->
      <button id="verifyFollowBtn" class="popup-btn" style="margin-top: 15px;" disabled>لقد تابعت، تحقق الآن</button>
      <p id="followStatus" style="font-size: 14px; color: #CD853F; margin-top: 10px; min-height: 20px;"></p>
    </div>
  </div>
  <!-- End Social Media Follow Popup Modal -->

  <!-- ********** START: Welcome Popup Modal ********** -->
  <div id="welcomePopupModal" class="popup-modal" style="z-index: 40;"> 
    <div class="popup-content welcome-popup-content">
      <h4>مرحبا بكم في موقع الباحث في رموز القبائل!</h4>
      <p>الموقع يساعدك بالبحث عن رموز القبائل بسهوله. وتوجد فيه ايضا عده مزايا ومميزات ومنها:</p>
      <ul>
        <li>
          <strong>البحث عن رموز القبائل:</strong><br>
          يمكنك البحث عن رمز قبيلتك عبر طريقتين وهما:<br>
          - عبر اسم القبيله<br>
          - او عبر رمزها
        </li>
        <li>
          <strong>البحث في معلومات وتواريخ القبائل:</strong><br>
          يمكنك البحث عن تاريخ القبائل عبر طريقتين وهما:<br>
          - تاريخ « اسم القبيله » ، مثل « تاريخ ال حميقان »<br>
          - معلومات « اسم القبيله » ، مثل « معلومات ال حميقان »
        </li>
        <li>
          <strong>البحث عن شيوخ القبائل:</strong><br>
          يمكنك البحث عن شيوخ القبائل عبر:<br>
          - كتابه ( شيخ « اسم القبيله» )، مثل « شيخ ال حميقان »
        </li>
      </ul>
      <p>لاضافه المزيد من المزايا تواصلوا معنا!</p>
      <div class="popup-buttons">
        <button id="welcomeUnderstandBtn" class="popup-btn">فهمت!</button>
      </div>
    </div>
  </div>
  <!-- ********** END: Welcome Popup Modal ********** -->

  <!-- Image Lightbox Modal -->
  <div id="imageLightbox" class="image-lightbox">
    <span class="close-lightbox" id="closeLightboxBtn">&times;</span>
    <img src="" alt="صورة مكبرة" id="lightboxImage">
  </div>
  <!-- End Image Lightbox Modal -->

  <!-- Success Notification -->
  <div id="successNotification" class="success-notification">
    <i class="bx bx-check-circle check-icon"></i>
    <div class="notification-text">شكراً لمتابعتنا! يمكنك الآن البحث في موقعنا</div>
  </div>
  <!-- End Success Notification -->

  <footer>
    <p>تم تصميمه بواسطة المبرمج <a href="https://wa.me/967738889982">سهم الحميقاني</a></p>
    <p>&copy; حقوق النشر محفوظة</p>
    <p class="extra">رمز | Ramz</p>
  </footer>
  <script async src="https://static.getclicky.com/101482035.js"></script>
  <noscript><p><img alt="Clicky" width="1" height="1" src="https://in.getclicky.com/101482035ns.gif" /></p></noscript>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, updateDoc, increment, setDoc, serverTimestamp, getDoc, query, where, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"; // Added query, where, limit

    const firebaseConfig = {
      apiKey: "AIzaSyDGLwl69D9W5c03G5WsfU8pahvVHL4zKzs",
      authDomain: "tribes-project-18d2b.firebaseapp.com",
      projectId: "tribes-project-18d2b",
      storageBucket: "tribes-project-18d2b.firebasestorage.app",
      messagingSenderId: "375771927234",
      appId: "1:375771927234:web:5fa0ec96fd9c80fce7615b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Function to increment site visitor count per session and per day
    async function trackVisitor() {
        const sessionKey = "siteVisitedThisSession";
        const today = new Date().toISOString().split("T")[0]; // YYYY-MM-DD format

        if (!sessionStorage.getItem(sessionKey)) {
            sessionStorage.setItem(sessionKey, "true");

            // Increment daily visitor count
            const dailyVisitorRef = doc(db, "siteAnalyticsByDay", today);
            try {
                await updateDoc(dailyVisitorRef, {
                    count: increment(1),
                    lastVisitTimestamp: serverTimestamp()
                });
                console.log(`Daily visitor count for ${today} incremented.`);
            } catch (error) {
                if (error.code === "not-found" || (error.message && error.message.includes("No document to update"))) {
                    await setDoc(dailyVisitorRef, { 
                        count: 1, 
                        date: today,
                        firstVisitTimestamp: serverTimestamp(), 
                        lastVisitTimestamp: serverTimestamp()
                    });
                    console.log(`Daily visitor counter for ${today} initialized and incremented.`);
                } else {
                    console.error(`Error incrementing daily visitor count for ${today}: `, error);
                }
            }

            // Increment total unique visitors (optional, if you still want a simple total)
            const totalUniqueVisitorsRef = doc(db, "siteAnalytics", "totalUniqueVisitors");
            try {
                await updateDoc(totalUniqueVisitorsRef, {
                    count: increment(1),
                    lastVisitTimestamp: serverTimestamp()
                });
                 console.log("Total unique visitor sessions count incremented.");
            } catch (error) {
                 if (error.code === "not-found" || (error.message && error.message.includes("No document to update"))) {
                    await setDoc(totalUniqueVisitorsRef, { 
                        count: 1, 
                        firstVisitTimestamp: serverTimestamp(), 
                        lastVisitTimestamp: serverTimestamp()
                    });
                    console.log("Total unique visitor sessions counter initialized.");
                } else {
                    console.error("Error incrementing total unique visitor sessions count: ", error);
                }
            }
        }
    }

    const hardcodedTribes = {
      "715": [{ name: "لقموش" }], "202": [{ name: "ردفان" }], "917": [{ name: "العوالق" }],
      "711": [{ name: "الحسين" },{ name: "الصيعر" },{ name: "وادعه" },{ name: "بني مالك" },{ name: "وايله" },{ name: "قيفة" },{ name: "دهم" },{ name: "مراد" },{ name: "كندة" },{ name: "الدين" },{ name: "آل سحاق" },{ name: "سحار" }],
      "505": [{ name: "قحطان" }, { name: "عبيده" }], "454": [{ name: "بلسمر" }],
      "509": [{ name: "بلقرن" },{ name: "الشرارات" }], "511": [{ name: "عتيبه" }, { name: "الحموم" }],
      "507": [{ name: "شهران" },{ name: "بني هلال" },{ name: "العمودي" }], 
      "606": [{ name: "اكلب" },{ name: "بني غانم" }],
      "911": [{ name: "البقوم" },{ name: "بني خالد" },{ name: "يام" }], "903": [{ name: "بارق" }],
      "309": [{ name: "بني حمد" },{ name: "البلوش" }], "601": [{ name: "بني الطمح" }], "811": [{ name: "نهد" }], "101": [{ name: "العجمان" }],
      "504": [{ name: "آل غريّبني" },{ name: "همام" }],
      "516": [{ name: "الجحادله" },{ name: "خولان" },{ name: "الجبره" }],
      "305": [{ name: "مطير" }], "518": [{ name: "جهينه" }, { name: "اللحوين" }], 
      "607": [{ name: "عليان" },{ name: "خثعم" }], "717": [{ name: "السهول" }, { name: "بلعبيد" }],
      "404": [{ name: "عبس" }, { name: "الرشايدة" }], "311": [{ name: "رجال الحجر" },{ name: "بني مسروح" }],
      "907": [{ name: "بني الحكم" },{ name: "بني ذبيان" }],
      "515": [{ name: "قريش" },{ name: "الاشراف" },{ name: "بني هاشم" },{ name: "سليم" },{ name: "النعيم" }],
      "808": [{ name: "تليد" }], "A-10": [{ name: "العميرة" }], "205": [{ name: "ظفير" }], "503": [{ name: "سبيع" }],
      "707": [{ name: "عسير" },{ name: "غامد" }], "703": [{ name: "بني يزيد" }], "779": [{ name: "الزيدي" }], "709": [{ name: "النواشر" }],
      "818": [{ name: "بلي" }], "708": [{ name: "بني مروان" }], "902": [{ name: "بني شبيب" }], "912": [{ name: "العوامر" }],
      "411": [{ name: "بني هاجر" }], "906": [{ name: "العوازم" }], "905": [{ name: "فيفاء" }],
      "107": [{ name: "المهره" },{ name: "الراشدي" }], "701": [{ name: "بني عمرو" }], "702": [{ name: "زهران" }],
      "502": [{ name: "الدواسر" }], "525": [{ name: "شمران" }], "901": [{ name: "ثقيف" },{ name: "الفضول" }],
      "506": [{ name: "بني تميم" }], "B-52": [{ name: "عنزه" }], "108": [{ name: "الجنيبي" }],
      "F-15": [{ name: "حرب" }], "555": [{ name: "شمر" }], "B-79": [{ name: "بني عطية" }], "111": [{ name: "الحويطات" }],
      "Y-10": [{ name: "بني يافع" }], "716": [{ name: "نعمان" }], "719": [{ name: "بنير" }, { name: "ال وهاش" }],
      "501": [{ name: "بلحارث" },{ name: "ال حميقان" },{ name: "الحميقاني" }],
      "611": [{ name: "العوابثه" },{ name: "باوزير" },{ name: "بني حسين" },{ name: "بني زيد" }],
      "705": [{ name: "بني هلال" },{ name: "ال باجري" }],
      "809": [{ name: "سيبان" }], "512": [{ name: "ال كثير" },{ name: "بني لام" },{ name: "فهم" }],
      "919": [{ name: "ال بريك" }],  "714": [{ name: "حمّير" }], "517": [{ name: "المشاجر" }],
      "S300": [{ name: "ال كثير" }], "604": [{ name: "المصعبين" }], "910": [{ name: "ال بريك" }], "F-14": [{ name: "الكرب" }],
      "712": [{ name: "نوح" },{ name: "سعد الظالمة" },{ name: "شرعب" }], "771": [{ name: "وصاب" }], "720": [{ name: "العواذل" }],
      "539": [{ name: "جهم" }], "519": [{ name: "الشحري" }, { name: "عك" }], "220": [{ name: "الطاهري" }], "959": [{ name: "بني شداد" }],
      "015": [{ name: "الحكلي" }], "918": [{ name: "ال بريك" }],
      "704": [{ name: "مقبنه" },{ name: "بني كعب" },{ name: "الشميري" }], "510": [{ name: "السودي" }],
      "909": [{ name: "الحدد" },{ name: "الحداد" }, { name: "بلحمر" }],
      "109": [{ name: "المناصير" }], "553": [{ name: "الظفري" }], "212": [{ name: "الانصار" }], "307": [{ name: "غزوان" }],
      "116": [{ name: "المشيخي" }], "F-10": [{ name: "ال شريح" }], "F-16": [{ name: "ال أسلم" }], "405": [{ name: "المصاريه" }],
      "55": [{ name: "ال مره" }], "L-82": [{ name: "المساعيد" }]
    };

    let combinedTribesData = {};
    let tribeInfoData = [];
    let sheikhsData = []; // إضافة مصفوفة لتخزين بيانات شيوخ القبائل

    const searchInput = document.getElementById("searchInput");
    const resultDiv = document.getElementById("result");
    const loadingDiv = document.getElementById("loading");
    const inputIcon = document.querySelector(".input-container .input-icon"); 
    const clearIcon = document.getElementById("clearBtn");
    const searchBtn = document.getElementById("searchBtn");
    
    const openSidebar = document.getElementById("openSidebar");
    const closeSidebar = document.getElementById("closeSidebar");
    const sidebar = document.getElementById("sidebar");
    const hamburger = document.querySelector(".hamburger");
    const homeLink = document.getElementById("homeLink");
    const orderLink = document.getElementById("orderLink");
    const contactLink = document.getElementById("contactLink");
    const socialContainer = document.getElementById("socialContainer");
    const aboutLink = document.getElementById("aboutLink");
    const adTelegramBtn = document.getElementById("adTelegramBtn");
    const cancelPopupBtn = document.getElementById("cancelBtn");
    const contactPopupBtn = document.getElementById("contactBtn");
    const faqQuestions = document.querySelectorAll(".faq-question");

    // Image Lightbox Elements
    const imageLightbox = document.getElementById("imageLightbox");
    const lightboxImage = document.getElementById("lightboxImage");
    const closeLightboxBtn = document.getElementById("closeLightboxBtn");

    // Social Media Popup Elements and Variables
    const socialPopupModal = document.getElementById("socialPopupModal");
    const instagramLink = document.getElementById("instagramLink");
    const facebookLink = document.getElementById("facebookLink");
    const verifyFollowBtn = document.getElementById("verifyFollowBtn"); // الزر الجديد
    const followStatus = document.getElementById("followStatus");
    let currentSearchQuery = null; 
    let instagramLinkClicked = false;
    let facebookLinkClicked = false;

    // Success Notification Element
    const successNotification = document.getElementById("successNotification");

    // Welcome Popup Elements
    const welcomePopupModal = document.getElementById("welcomePopupModal");
    const welcomeUnderstandBtn = document.getElementById("welcomeUnderstandBtn");
    const WELCOME_POPUP_KEY = "welcomePopupShown_v3"; // Use a new key

    function fadeOutAndRedirect(url) {
      document.body.classList.add("fade-out");
      setTimeout(function() { window.location.href = url; }, 500);
    }

    function normalizeArabic(text) {
      return text.toLowerCase().replace(/[إأآا]/g, "ا").replace(/ة/g, "ه").replace(/[ىئ]/g, "ي").replace(/["\u064B-\u0652]/g, "").trim();
    }
    
    function showPopup(query, type = "tribe") {
      const popupModal = document.getElementById("popupModal");
      const popupMessage = document.getElementById("popupMessage");
      if (popupModal && popupMessage) {
        if (type === "history_popup") { 
            popupMessage.innerHTML = `لم يتم العثور على معلومات تاريخية للقبيلة (<strong>${query}</strong>). يمكنك التواصل معنا لإضافتها.`;
        } else if (type === "code") {
            popupMessage.innerHTML = `قد يكون رمز (<strong>${query}</strong>) يتبع لقبيلة غير مسجلة في المنصة، يمكنك التواصل معنا في حال أردت إضافته`;
        } else if (type === "sheikh_popup") {
            popupMessage.innerHTML = `لم يتم العثور على شيخ لقبيلة (<strong>${query}</strong>). يمكنك التواصل معنا لإضافته.`;
        } else {
            popupMessage.innerHTML = `قد يكون الرمز لقبيلة (<strong>${query}</strong>) غير مضاف حالياً قم بالتواصل معنا لتعريفه وإضافته في المنصة`;
        }
        popupModal.style.display = "flex";
        if(contactPopupBtn) contactPopupBtn.onclick = function() { window.location.href = "https://wa.me/967738889982"; };
      }
    }

    if (openSidebar) openSidebar.addEventListener("click", () => { sidebar.classList.toggle("active"); hamburger.classList.toggle("active"); });
    if (closeSidebar) closeSidebar.addEventListener("click", () => { sidebar.classList.remove("active"); hamburger.classList.remove("active"); });
    if (homeLink) homeLink.addEventListener("click", () => { sidebar.classList.remove("active"); hamburger.classList.remove("active"); document.querySelector(".container").scrollIntoView({ behavior: "smooth" }); });
    if (contactLink) contactLink.addEventListener("click", () => { socialContainer.classList.toggle("active"); });
    if (aboutLink) aboutLink.addEventListener("click", function(event) { event.preventDefault(); fadeOutAndRedirect(this.href); });
    if (orderLink) orderLink.addEventListener("click", function(event) { event.preventDefault(); fadeOutAndRedirect(this.href); });
    if (searchInput) searchInput.addEventListener("input", function () { if (searchInput.value.trim().length > 0) { inputIcon.style.display = "none"; clearIcon.style.display = "block"; } else { inputIcon.style.display = "block"; clearIcon.style.display = "none"; } });
    if (clearIcon) clearIcon.addEventListener("click", function () { searchInput.value = ""; inputIcon.style.display = "block"; clearIcon.style.display = "none"; searchInput.focus(); resultDiv.innerHTML = ""; resultDiv.classList.remove("show"); });
    
    if (searchBtn) searchBtn.addEventListener("click", performSearch);
    if (searchInput) searchInput.addEventListener("keydown", function (e) { if (e.key === "Enter") performSearch(); });
    
    if (cancelPopupBtn) cancelPopupBtn.addEventListener("click", function() { document.getElementById("popupModal").style.display = "none"; });
    if (adTelegramBtn) adTelegramBtn.addEventListener("click", function() { window.location.href = "https://wa.me/967738889982"; });
    faqQuestions.forEach((question) => { question.addEventListener("click", function () { const answer = this.nextElementSibling; const icon = this.querySelector(".faq-icon"); const isActive = this.classList.contains("active"); faqQuestions.forEach(q => { if (q !== this && q.classList.contains("active")) { q.classList.remove("active"); q.nextElementSibling.style.display = "none"; const otherIcon = q.querySelector(".faq-icon"); if (otherIcon) otherIcon.classList.replace("bx-chevron-up", "bx-chevron-down"); } }); if (isActive) { answer.style.display = "none"; this.classList.remove("active"); if (icon) icon.classList.replace("bx-chevron-up", "bx-chevron-down"); } else { answer.style.display = "block"; this.classList.add("active"); if (icon) icon.classList.replace("bx-chevron-down", "bx-chevron-up"); } }); });

    // Image Lightbox Close Logic
    if (closeLightboxBtn) {
        closeLightboxBtn.addEventListener("click", () => {
            if (imageLightbox) imageLightbox.style.display = "none";
        });
    }
    if (imageLightbox) {
        imageLightbox.addEventListener("click", (event) => {
            // Close if the click is on the background itself, not the image
            if (event.target === imageLightbox) {
                imageLightbox.style.display = "none";
            }
        });
    }

    // Function to show success notification
    function showSuccessNotification() {
      if (successNotification) {
        successNotification.classList.add("show");
        setTimeout(() => {
          successNotification.classList.remove("show");
        }, 3000); // Hide after 3 seconds
      }
    }

    // Social Media Follow Button Logic
    if (instagramLink) {
      instagramLink.addEventListener("click", () => {
        instagramLinkClicked = true;
        if (instagramLinkClicked && facebookLinkClicked) {
          verifyFollowBtn.disabled = false;
          verifyFollowBtn.style.background = "linear-gradient(90deg, #CD853F, #D2B48C)"; // Restore original color
          followStatus.textContent = "الآن يمكنك الضغط على زر التحقق.";
          followStatus.style.color = "#28a745";
        } else if (instagramLinkClicked) {
          followStatus.textContent = "أحسنت! الآن قم بالاعحاب بالتفاعل على اسم ( احمد الحميقاني ) ";
          followStatus.style.color = "#CD853F";
        }
      });
    }

    if (facebookLink) {
      facebookLink.addEventListener("click", () => {
        facebookLinkClicked = true;
        if (instagramLinkClicked && facebookLinkClicked) {
          verifyFollowBtn.disabled = false;
          verifyFollowBtn.style.background = "linear-gradient(90deg, #CD853F, #D2B48C)"; // Restore original color
          followStatus.textContent = "الآن يمكنك الضغط على زر التحقق.";
          followStatus.style.color = "#28a745";
        } else if (facebookLinkClicked) {
          followStatus.textContent = "أحسنت! الآن تابع قناتنا على الواتساب.";
          followStatus.style.color = "#CD853F";
        }
      });
    }

    if (verifyFollowBtn) {
      verifyFollowBtn.addEventListener("click", () => {
        const attemptKey = 'followAttempt_v1';
        let attemptCount = localStorage.getItem(attemptKey);

        verifyFollowBtn.disabled = true;
        followStatus.innerHTML = 'جاري التحقق... <i class="bx bx-loader-alt bx-spin"></i>';
        followStatus.style.color = "#CD853F";

        setTimeout(() => {
          if (attemptCount !== '1') {
            // First attempt: Show failure message
            followStatus.innerHTML = '<span style="color: red;">فشل التحقق. يبدو أنك لم تقم بالمتابعة. حاول مجدداً بعد المتابعة.</span>';
            localStorage.setItem(attemptKey, '1'); // Mark first attempt
            verifyFollowBtn.disabled = true; // Disable button again
            verifyFollowBtn.style.background = "#cccccc"; // Set button to grey
            verifyFollowBtn.textContent = "تحقق مرة أخرى"; // Change button text
            // Reset click states to require following again
            instagramLinkClicked = false;
            facebookLinkClicked = false;
            followStatus.innerHTML = '<span style="color: red;">فشل التحقق. يبدو أنك لم تقم بالمتابعة. حاول مجدداً بعد المتابعة.</span><br><span style="color: #CD853F; font-size: 14px;">تابع حسابنا على انستغرام للمتابعة.</span>';
          } else {
            // Second attempt: Show success message
            followStatus.innerHTML = '<span style="color: green;">شكراً لدعمك! تم تفعيل البحث.</span>';
            localStorage.setItem("socialFollowed", "true"); // Grant access
            localStorage.removeItem(attemptKey); // Clean up attempt counter

            // Show success notification
            showSuccessNotification();

            // Close popup and perform search
            setTimeout(() => {
              if (socialPopupModal) socialPopupModal.style.display = "none";
              if (currentSearchQuery) {
                initiateSearchProcess(currentSearchQuery);
              }
            }, 1500); // Wait to show success message
          }
        }, 3000); // 3-second timer
      });
    }

    // Welcome Popup Button Logic
    if (welcomeUnderstandBtn && welcomePopupModal) {
        welcomeUnderstandBtn.addEventListener("click", () => {
            welcomePopupModal.style.display = "none";
            localStorage.setItem(WELCOME_POPUP_KEY, "true");
            // إزالة فئة no-scroll من الجسم عند إغلاق النافذة المنبثقة
            document.body.classList.remove("no-scroll");
        });
    }

    function displayNotFoundMessage(messageContent) {
        const messageBox = document.createElement("div");
        messageBox.className = "tribe-box"; 
        messageBox.style.color = "#3E2723"; 
        messageBox.textContent = messageContent;
        resultDiv.appendChild(messageBox);
    }

    function performSearch() {
      if (!searchInput || !resultDiv || !loadingDiv) return;
      const query = searchInput.value.trim();
      currentSearchQuery = query; 

      if (!query) {
        displayNotFoundMessage("يرجى ملء خانة البحث");
        resultDiv.classList.add("show");
        return;
      }

      if (!localStorage.getItem("socialFollowed")) {
        if (socialPopupModal) {
            socialPopupModal.style.display = "flex";
            // Reset status for new attempt
            followStatus.innerHTML = "تابعنا على قناتنا الواتساب للمتابعة."; // Initial message
            followStatus.style.color = "#CD853F";
            verifyFollowBtn.disabled = true; // Disable button initially
            verifyFollowBtn.textContent = "لقد تابعت، تحقق الآن"; // Reset button text
            verifyFollowBtn.style.background = "#cccccc"; // Set button to grey
            instagramLinkClicked = false; // Reset click states
            facebookLinkClicked = false;
        }
        return; 
      }

      initiateSearchProcess(currentSearchQuery);
    }

    function initiateSearchProcess(queryToSearch) {
        if (!queryToSearch) return; 

        if (window.clicky) clicky.log("بحث_موقع", queryToSearch);
        resultDiv.classList.remove("show");
        resultDiv.innerHTML = "";
        loadingDiv.style.display = "flex";

        if (Object.keys(combinedTribesData).length === 0 && tribeInfoData.length === 0 && sheikhsData.length === 0) {
            loadAndMergeData().then(() => executeSearchLogic(queryToSearch)).catch(error => {
                loadingDiv.style.display = "none";
                displayNotFoundMessage("فشل تحميل البيانات، يرجى المحاولة مرة أخرى.");
                resultDiv.classList.add("show");
            });
        } else {
            executeSearchLogic(queryToSearch);
        }
    }

    function executeSearchLogic(query) {
        const delay = Math.floor(Math.random() * 1000) + 500;
        setTimeout(function () {
            loadingDiv.style.display = "none";
            const normalizedQuery = normalizeArabic(query);
            const historyKeyword = "تاريخ ";
            const infoKeyword = "معلومات ";
            const sheikhKeyword = "شيخ "; // إضافة كلمة مفتاحية للبحث عن شيخ القبيلة

            if (normalizedQuery.startsWith(normalizeArabic(historyKeyword)) || normalizedQuery.startsWith(normalizeArabic(infoKeyword))) {
                let tribeNameForHistory = "";
                if (normalizedQuery.startsWith(normalizeArabic(historyKeyword))) {
                    tribeNameForHistory = query.substring(historyKeyword.length).trim();
                } else if (normalizedQuery.startsWith(normalizeArabic(infoKeyword))) {
                    tribeNameForHistory = query.substring(infoKeyword.length).trim();
                }
                
                const normalizedTribeNameForHistory = normalizeArabic(tribeNameForHistory);
                const foundHistory = tribeInfoData.find(info => normalizeArabic(info.name) === normalizedTribeNameForHistory);

                if (foundHistory) {
                    if (window.clicky) clicky.log("نتيجة_بحث_تاريخ", tribeNameForHistory);
                    const historyBox = document.createElement("div");
                    historyBox.className = "history-box";
                    const title = document.createElement("h4");
                    title.textContent = `معلومات عن قبيلة ${foundHistory.name}`;
                    historyBox.appendChild(title);
                    const historyParagraph = document.createElement("p");
                    historyParagraph.innerHTML = foundHistory.history;
                    historyBox.appendChild(historyParagraph);
                    resultDiv.appendChild(historyBox);
                } else {
                    displayNotFoundMessage(`لم يتم اضافه معلومات (${tribeNameForHistory})`);
                    if (window.clicky) clicky.log("بحث_تاريخ_غير_ناجح", tribeNameForHistory);
                    setTimeout(() => showPopup(tribeNameForHistory, "history_popup"), 1500);
                }
            } else if (normalizedQuery.startsWith(normalizeArabic(sheikhKeyword))) {
                // منطق البحث عن شيخ القبيلة
                let tribeNameForSheikh = query.substring(sheikhKeyword.length).trim();
                const normalizedTribeNameForSheikh = normalizeArabic(tribeNameForSheikh);
                
                // البحث عن شيخ القبيلة في البيانات المحملة
                const foundSheikh = sheikhsData.find(sheikh => normalizeArabic(sheikh.tribeName) === normalizedTribeNameForSheikh);
                
                if (foundSheikh) {
                    if (window.clicky) clicky.log("نتيجة_بحث_شيخ", tribeNameForSheikh);
                    
                    // إنشاء مربع عرض شيخ القبيلة
                    const sheikhBox = document.createElement("div");
                    sheikhBox.className = "sheikh-box";
                    
                    // إضافة حاوية الصورة
                    const imageContainer = document.createElement("div");
                    imageContainer.className = "sheikh-image-container";
                    
                    // إضافة صورة الشيخ
                    const sheikhImage = document.createElement("img");
                    sheikhImage.className = "sheikh-image";
                    sheikhImage.src = foundSheikh.imageUrl;
                    sheikhImage.alt = `شيخ قبيلة ${foundSheikh.tribeName}`;
                    sheikhImage.onerror = function() {
                        this.src = "https://via.placeholder.com/300x200?text=صورة+غير+متوفرة";
                    };
                    // Add click listener to open lightbox
                    sheikhImage.style.cursor = "pointer"; // Indicate it's clickable
                    sheikhImage.addEventListener("click", () => {
                        if (lightboxImage && imageLightbox) {
                            lightboxImage.src = sheikhImage.src;
                            imageLightbox.style.display = "flex";
                        }
                    });
                    imageContainer.appendChild(sheikhImage);
                    sheikhBox.appendChild(imageContainer);
                    
                    // إضافة اسم الشيخ بلون ذهبي
                    const sheikhName = document.createElement("div");
                    sheikhName.className = "sheikh-name";
                    sheikhName.textContent = foundSheikh.sheikhName;
                    sheikhBox.appendChild(sheikhName);
                    
                    resultDiv.appendChild(sheikhBox);
                } else {
                    displayNotFoundMessage(`لم يتم العثور على شيخ قبيلة (${tribeNameForSheikh})`);
                    if (window.clicky) clicky.log("بحث_شيخ_غير_ناجح", tribeNameForSheikh);
                    setTimeout(() => showPopup(tribeNameForSheikh, "sheikh_popup"), 1500);
                }
            } else {
                if (/^\d+$|^(?:[A-Z]-?\d+)$/i.test(query)) {
                    let code = query.toUpperCase();
                    if (/^(?:[A-Z])\d+$/i.test(code)) code = code.replace(/^(?:([A-Z]))/, "$1-");
                    if (!combinedTribesData[code] && code.includes("-")) { let codeNoDash = code.replace("-", ""); if (combinedTribesData[codeNoDash]) code = codeNoDash; }

                    if (combinedTribesData[code]) {
                        if (window.clicky) clicky.log("نتيجة_بحث_رمز", combinedTribesData[code].map(e => e.name).join(", ") + " (" + code + ")");
                        if (combinedTribesData[code].length > 1) {
                            const table = document.createElement("table"); table.className = "result-table";
                            const thead = document.createElement("thead"); const hr = document.createElement("tr");
                            const thc = document.createElement("th"); thc.textContent = "الرمز";
                            const tht = document.createElement("th"); tht.textContent = "القبائل المشتركة";
                            hr.appendChild(thc); hr.appendChild(tht); thead.appendChild(hr); table.appendChild(thead);
                            const tbody = document.createElement("tbody"); const r = document.createElement("tr");
                            const tdc = document.createElement("td"); tdc.textContent = code;
                            const tdt = document.createElement("td"); tdt.textContent = combinedTribesData[code].map((entry) => entry.name).join(", ");
                            r.appendChild(tdc); r.appendChild(tdt); tbody.appendChild(r); table.appendChild(tbody);
                            resultDiv.appendChild(table);
                        } else {
                            combinedTribesData[code].forEach(function (entry) {
                                const box = document.createElement("div"); box.className = "tribe-box";
                                box.textContent = `هذا الرمز ${code} يعود لقبيلة ${entry.name}`;
                                resultDiv.appendChild(box);
                            });
                        }
                    } else {
                        displayNotFoundMessage("عفواً لم يتم العثور على قبيلة بهذا الرمز");
                        if (window.clicky) clicky.log("بحث_رمز_غير_ناجح", query);
                        setTimeout(() => showPopup(query, "code"), 1500);
                    }
                } else {
                    let found = false;
                    const matchingTribes = [];
                    for (const codeKey in combinedTribesData) {
                        if (combinedTribesData.hasOwnProperty(codeKey)) {
                            combinedTribesData[codeKey].forEach(function (entry) {
                                if (normalizeArabic(entry.name).includes(normalizedQuery)) {
                                    if (!matchingTribes.some(t => t.name === entry.name && t.code === codeKey)) {
                                        matchingTribes.push({name: entry.name, code: codeKey});
                                    }
                                    found = true;
                                }
                            });
                        }
                    }
                    if (found) {
                        matchingTribes.forEach(match => {
                            if (window.clicky) clicky.log("نتيجة_بحث_اسم", match.name + " (" + match.code + ")");
                            const box = document.createElement("div"); box.className = "tribe-box";
                            box.textContent = `${match.name} رمز القبيلة هو ${match.code}`;
                            resultDiv.appendChild(box);
                        });
                    } else {
                        displayNotFoundMessage("عفواً لم يتم العثور على رمز لهذه القبيلة");
                        if (window.clicky) clicky.log("بحث_اسم_غير_ناجح", query);
                        setTimeout(() => showPopup(query, "tribe"), 1500);
                    }
                }
            }
            resultDiv.classList.add("show");
        }, delay);
    }

    async function loadAndMergeData() {
        let firebaseFetchedTribes = {};
        try {
            const tribesCollectionRef = collection(db, "tribes");
            const querySnapshot = await getDocs(tribesCollectionRef);
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                if (data.code && data.name) {
                    if (!firebaseFetchedTribes[data.code]) firebaseFetchedTribes[data.code] = [];
                    if (!firebaseFetchedTribes[data.code].some(e => e.name === data.name)) {
                        firebaseFetchedTribes[data.code].push({ name: data.name });
                    }
                }
            });
        } catch (error) {
            console.error("فشل تحميل رموز القبائل من Firebase:", error);
        }

        let newMergedData = JSON.parse(JSON.stringify(hardcodedTribes));
        for (const codeKey in firebaseFetchedTribes) {
            if (firebaseFetchedTribes.hasOwnProperty(codeKey)) {
                if (newMergedData.hasOwnProperty(codeKey)) {
                    const existingTribes = newMergedData[codeKey]; 
                    const firebaseTribesForCode = firebaseFetchedTribes[codeKey]; 
                    firebaseTribesForCode.forEach(fbTribe => {
                        if (!existingTribes.some(existingTribe => existingTribe.name === fbTribe.name)) {
                            existingTribes.push(fbTribe);
                        }
                    });
                } else {
                    newMergedData[codeKey] = firebaseFetchedTribes[codeKey];
                }
            }
        }
        combinedTribesData = newMergedData;
        console.log("بيانات رموز القبائل المدمجة جاهزة:", Object.keys(combinedTribesData).length, "رموز.");

        tribeInfoData.length = 0;
        try {
            const historyCollectionRef = collection(db, "histories");
            const historySnapshot = await getDocs(historyCollectionRef);
            historySnapshot.forEach((doc) => {
                const data = doc.data();
                if(data.name && data.history) tribeInfoData.push({ name: data.name, history: data.history.replace(/\n/g, "<br>") });
            });
            console.log("تم تحميل بيانات تاريخ القبائل:", tribeInfoData.length, "إدخالات.");
        } catch (historyError) {
            console.error("فشل تحميل بيانات تاريخ القبائل:", historyError);
        }

        // تحميل بيانات شيوخ القبائل
        sheikhsData.length = 0;
        try {
            const sheikhsCollectionRef = collection(db, "sheikhs");
            const sheikhsSnapshot = await getDocs(sheikhsCollectionRef);
            sheikhsSnapshot.forEach((doc) => {
                const data = doc.data();
                if(data.tribeName && data.sheikhName && data.imageUrl) {
                    sheikhsData.push({
                        tribeName: data.tribeName,
                        sheikhName: data.sheikhName,
                        imageUrl: data.imageUrl
                    });
                }
            });
            console.log("تم تحميل بيانات شيوخ القبائل:", sheikhsData.length, "إدخالات.");
        } catch (sheikhsError) {
            console.error("فشل تحميل بيانات شيوخ القبائل:", sheikhsError);
        }
    }

    window.addEventListener("DOMContentLoaded", async () => {
        // Show Welcome Popup Logic - MOVED FOR SPEED
        if (welcomePopupModal && !localStorage.getItem(WELCOME_POPUP_KEY)) { // Check localStorage first
            welcomePopupModal.style.display = "flex";
            // إضافة فئة no-scroll إلى الجسم لمنع التمرير
            document.body.classList.add("no-scroll");
        }

        // Now load data and track visitor
        await loadAndMergeData();
        await trackVisitor(); // Call the function to track visitor on page load

        // Original position of popup logic (now removed from here)
    });
  </script>
</body>
</html>
